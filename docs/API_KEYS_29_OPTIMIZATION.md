# 🚀 29개 API 키 최적화 설정

## 현재 설정 (29개 Search API 키)

### 최적화된 파라미터

| 파라미터 | 값 | 설명 |
|---------|-----|------|
| `fillBatch` | **100개** | 한 번에 처리하는 키워드 수 |
| `fillConcurrency` | **24개** | 동시에 처리하는 키워드 수 |
| `INTERVAL_SECONDS` | **20초** | API 호출 간격 |
| `RUN_FOR_SECONDS` | **180초** | 총 실행 시간 (3분) |

### 예상 처리량

**이론상 최대치:**
- 실행당: (180/20=9회) × 100개 = **900개 키워드**
- 하루: 900개 × 288회 = **259,200개 키워드**

**실제 안전한 처리량:**
- 실행당: 약 **600-800개 키워드** (안정적)
- 하루: 약 **100,000-120,000개 키워드** (목표 달성)

**Search API 호출:**
- 각 키워드당 4개 호출 (blog, cafe, web, news)
- 하루 약 400,000-480,000회 호출
- API 한도: 29개 키 × 25,000 = **725,000회/일**
- 한도 사용률: 약 **55-66%** (안전한 범위)

---

## API 키 현황

### 총 29개 Search API 키
- 기존: 9개
- 추가: 20개
- **총합: 29개**

### API 한도 계산
- 키당 하루 한도: 25,000회
- 총 하루 한도: 29 × 25,000 = **725,000회**
- 현재 사용량: 약 400,000-480,000회
- 여유 한도: 약 245,000-325,000회

---

## 성능 모니터링

### 확인 방법

1. **GitHub Actions 로그**
   ```
   📊 총 처리된 키워드: XXX개
   ```

2. **모니터링 페이지**
   - `/monitor` 접속
   - "최근 24시간 문서수" 확인

3. **목표 달성 확인**
   - 하루 100,000개 이상 처리 시 목표 달성

---

## 추가 최적화 가능 여부

### 현재 설정으로도 충분
- 하루 100,000-120,000개 처리 가능
- API 한도 사용률 55-66% (안전)

### 더 높은 처리량이 필요한 경우

**옵션 1: fillBatch 증가**
```yaml
fillBatch=120  # 100 → 120
```
- 하루 약 120,000-150,000개 가능
- 단, Vercel 타임아웃 주의

**옵션 2: fillConcurrency 증가**
```yaml
fillConcurrency=28  # 24 → 28
```
- 더 많은 동시 처리
- 단, API rate limit 주의

**옵션 3: INTERVAL_SECONDS 감소**
```yaml
INTERVAL_SECONDS=18  # 20 → 18
```
- 더 자주 호출
- 단, API 부하 증가

---

## 주의사항

### 1. Vercel 타임아웃
- `maxRunMs=55000`: 55초 제한 유지
- `fillBatch=100`은 안전한 범위
- 더 증가 시 타임아웃 가능성 있음

### 2. API Rate Limit
- 29개 키로 충분하지만
- 너무 빠른 호출 시 일시적 제한 가능
- 현재 설정은 안전한 범위

### 3. 데이터베이스 부하
- Turso의 Writes 한도 확인
- 하루 100,000개 업데이트 = 약 100,000 writes
- Turso 무료 플랜: 10M writes/월 (충분)

---

## 문제 해결

### 처리량이 낮은 경우

1. **로그 확인**
   - GitHub Actions 로그에서 에러 확인
   - rate limit 발생 여부 확인

2. **파라미터 조정**
   - `fillBatch` 증가 (100 → 120)
   - `fillConcurrency` 증가 (24 → 28)

3. **간격 조정**
   - `INTERVAL_SECONDS` 감소 (20 → 18)

### Rate Limit 발생 시

1. **동시 처리 감소**
   - `fillConcurrency` 감소 (24 → 20)

2. **간격 증가**
   - `INTERVAL_SECONDS` 증가 (20 → 25)

---

## 현재 상태

✅ **최적화 완료**
- 29개 API 키에 맞춘 최적 설정
- 하루 100,000-120,000개 처리 가능
- API 한도 사용률 55-66% (안전)

✅ **배포 완료**
- GitHub Actions 워크플로우 업데이트
- 코드 최적화 완료

---

## 다음 실행 확인

다음 크론 실행 시:
- 실행당 약 600-800개 키워드 처리 예상
- 하루 약 100,000-120,000개 처리 예상
- 목표 달성 확인

