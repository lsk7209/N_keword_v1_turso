# 📊 1일 최대 수집량 분석 및 최적화 방안

## 현재 설정 기준 1일 최대 수집량

### 🔍 연관검색어 수집 (Expand)

**현재 설정:**
- 스케줄: 15분마다 (`*/15 * * * *`)
- 실행 시간: 180초 (3분)
- 호출 간격: 30초
- 배치 크기: 300개 시드
- 동시성: 50
- 시드당 평균 수집: 20개 키워드

**계산 결과:**
- 하루 실행 횟수: **96회**
- 실행당 호출 횟수: **6회** (180초 ÷ 30초)
- 실행당 수집 키워드: **36,000개** (6회 × 300 시드 × 20개)
- 일일 수집 키워드 (이론상): **3,456,000개**
- 일일 수집 키워드 (안전, 80% 효율): **2,764,800개**

---

### 📄 문서수 수집 (Fill Docs)

**현재 설정:**
- 스케줄: 5분마다 (`2-59/5 * * * *`)
- 실행 시간: 180초 (3분)
- 호출 간격: 20초
- 배치 크기: 180개 키워드
- 동시성: 28

**계산 결과:**
- 하루 실행 횟수: **288회**
- 실행당 호출 횟수: **9회** (180초 ÷ 20초)
- 실행당 처리 키워드: **1,620개** (9회 × 180개)
- 일일 처리 키워드 (이론상): **466,560개**
- 일일 처리 키워드 (안전, 80% 효율): **373,248개**

---

## 📊 종합 결과

| 작업 유형 | 이론상 최대 | 안전 기준 (80%) |
|----------|------------|----------------|
| 연관검색어 수집 | 3,456,000개/일 | **2,764,800개/일** |
| 문서수 수집 | 466,560개/일 | **373,248개/일** |
| **총합** | **3,922,560개/일** | **3,138,048개/일** |

---

## 🚀 최적화 방안

### 목표 설정

현재 읽기/쓰기 최적화가 완료되었으므로, 다음 목표를 설정할 수 있습니다:

1. **연관검색어 수집**: 일일 300만개 이상
2. **문서수 수집**: 일일 50만개 이상
3. **총 수집량**: 일일 350만개 이상

### 최적화 옵션

#### 옵션 1: 빈도 증가 (보수적)

**Expand 작업:**
- 스케줄: 15분 → **10분** (`*/10 * * * *`)
- 하루 실행 횟수: 96회 → **144회**
- 일일 수집량: 2,764,800개 → **4,147,200개** (50% 증가)

**Fill Docs 작업:**
- 스케줄: 5분 → **3분** (`*/3 * * * *`)
- 하루 실행 횟수: 288회 → **480회**
- 일일 처리량: 373,248개 → **622,080개** (67% 증가)

**총 수집량**: 3,138,048개 → **4,769,280개** (52% 증가)

---

#### 옵션 2: 배치 크기 증가 (공격적)

**Expand 작업:**
- 배치 크기: 300 → **500**
- 실행당 수집: 36,000개 → **60,000개**
- 일일 수집량: 2,764,800개 → **4,608,000개** (67% 증가)

**Fill Docs 작업:**
- 배치 크기: 180 → **250**
- 실행당 처리: 1,620개 → **2,250개**
- 일일 처리량: 373,248개 → **518,400개** (39% 증가)

**총 수집량**: 3,138,048개 → **5,126,400개** (63% 증가)

---

#### 옵션 3: 실행 시간 증가 (균형)

**Expand 작업:**
- 실행 시간: 180초 → **240초** (4분)
- 호출 횟수: 6회 → **8회** (30초 간격 유지)
- 실행당 수집: 36,000개 → **48,000개**
- 일일 수집량: 2,764,800개 → **3,686,400개** (33% 증가)

**Fill Docs 작업:**
- 실행 시간: 180초 → **240초** (4분)
- 호출 횟수: 9회 → **12회** (20초 간격 유지)
- 실행당 처리: 1,620개 → **2,160개**
- 일일 처리량: 373,248개 → **497,664개** (33% 증가)

**총 수집량**: 3,138,048개 → **4,184,064개** (33% 증가)

---

#### 옵션 4: 복합 최적화 (권장)

**Expand 작업:**
- 스케줄: 15분 → **12분** (`*/12 * * * *`)
- 실행 시간: 180초 → **210초** (3.5분)
- 배치 크기: 300 → **400**
- 하루 실행 횟수: 96회 → **120회**
- 실행당 호출: 6회 → **7회**
- 실행당 수집: 36,000개 → **56,000개** (7회 × 400 × 20)
- 일일 수집량: **6,720,000개** (이론상) → **5,376,000개** (안전, 80%)

**Fill Docs 작업:**
- 스케줄: 5분 → **4분** (`*/4 * * * *`)
- 실행 시간: 180초 → **200초**
- 배치 크기: 180 → **220**
- 하루 실행 횟수: 288회 → **360회**
- 실행당 호출: 9회 → **10회**
- 실행당 처리: 1,620개 → **2,200개**
- 일일 처리량: **792,000개** (이론상) → **633,600개** (안전, 80%)

**총 수집량**: **6,009,600개/일** (안전 기준)

---

## ⚠️ 주의사항

### API 한도 고려

**Naver Ad API (연관검색어):**
- 키당 일일 한도: 약 10,000회
- 현재 키 개수: 확인 필요
- 예상 호출: (5,376,000 ÷ 20) = 268,800회/일
- 필요 키 개수: 약 27개

**Naver Search API (문서수):**
- 키당 일일 한도: 25,000회
- 키워드당 4회 호출 (blog, cafe, web, news)
- 예상 호출: 633,600 × 4 = 2,534,400회/일
- 필요 키 개수: 약 102개

### Turso Write 한도

- 현재 한도: 25M/월
- 일일 한도: 약 833,333회
- 예상 Write:
  - 연관검색어: 5,376,000회/일
  - 문서수: 633,600회/일 (UPDATE)
  - 총합: 약 6,009,600회/일

**⚠️ 한도 초과 위험**: 현재 Turso Write 한도로는 옵션 4를 실행하기 어렵습니다.

---

## 🎯 권장 최적화 방안

### 단계별 접근

#### 1단계: 보수적 증가 (즉시 적용 가능)

**Expand 작업:**
- 스케줄: 15분 → **12분**
- 배치 크기: 300 → **350**
- 일일 수집량: 2,764,800개 → **약 3,500,000개**

**Fill Docs 작업:**
- 스케줄: 5분 → **4분**
- 배치 크기: 180 → **200**
- 일일 처리량: 373,248개 → **약 500,000개**

**총 수집량**: **약 4,000,000개/일**

#### 2단계: 모니터링 후 확대

Turso Write 사용량을 모니터링하며 점진적으로 증가:
- Expand 배치: 350 → 400 → 450
- Fill Docs 배치: 200 → 220 → 240

---

## 📝 구현 방법

### 1. GitHub Actions 워크플로우 수정

**`.github/workflows/miner.yml`:**
```yaml
schedule:
  - cron: '*/12 * * * *'  # 15분 → 12분

QUERY="task=expand&mode=TURBO&expandBatch=350&expandConcurrency=50&minSearchVolume=100&maxRunMs=58000"
```

**`.github/workflows/fill-docs.yml`:**
```yaml
schedule:
  - cron: '*/4 * * * *'  # 5분 → 4분

QUERY="task=fill_docs&fillBatch=200&fillConcurrency=28&maxRunMs=55000"
```

### 2. 모니터링 스크립트

Turso 사용량을 주기적으로 확인하여 한도 초과를 방지합니다.

